<div class="row">
  <%= form_for(@record) do |f| %>
    <% if @record.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@record.errors.count, "error") %> prohibited this record from being saved:</h2>

        <ul>
        <% @record.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
        </ul>
      </div>
    <% end %>
    <div class="form-group">
      <div class="col-xs-6 col-sm-3">
          <br>
          <%= f.text_field :firstname, autofocus: true, :class => "input-lg form-control", "placeholder" => "first name" %>
      </div>
      <div class="col-xs-6 col-sm-3">
          <br>
          <%= f.text_field :lastname, :class => "input-lg form-control", "placeholder" => "last name"  %>
      </div>
      <div class="col-xs-6 col-sm-3">
          <br>
          <%= f.text_field :phone, :class => "input-lg form-control", "placeholder" => "phone"  %>
      </div>
      <div class="col-xs-6 col-sm-3">
          <br>
          <%= f.text_field :email, :class => "input-lg form-control", "placeholder" => "email"  %>
      </div>
      <div class="field" hidden="true">
        <br>  
        <%= f.label :receivedate %><br>
        <%= f.datetime_select :receivedate, :class => "input-lg form-control" %>
      </div>
      <div class="col-xs-4 col-sm-4">
        <div class="input-group">
          <div class="input-group-addon">Progress </div>
          <% listofprogress = [["New", "New"],["In Progress", "In Progress"],["On Hold", "On Hold"],["Completed", "Completed"],["Dropped", "Dropped"],["Unknown", "Unknown"]] %>
            <%= f.select :progress, options_for_select(listofprogress, @record.progress.to_s), {prompt: true}, { :class => "btn btn-default btn-lg dropdown-toggle btn-lg input-lg form-control", "required"=>"true"} %>
        </div>
      </div>
      <div class="col-xs-4 col-sm-4">
        <div class="input-group">
          <div class="input-group-addon">Loan Officer </div>
          <% listoflos = [] %>
          <% @profiles.each do |profile|  %>
            <% listoflos.push(profile) if profile.title == "loan officer" %>
          <% end %>
          <%= f.collection_select :loanofficer_id, listoflos, :user_id, :firstname, {prompt: true}, { :class => "btn btn-default btn-lg dropdown-toggle btn-lg input-lg form-control"} %>
        </div>
      </div>
      <div class="col-xs-4 col-sm-4">
        <div class="input-group">
          <div class="input-group-addon">Processor </div>
          <% listofpros = [] %>
          <% mynewprofile = Profile.new %>
          <% mynewprofile.id = "0" %>
          <% mynewprofile.firstname = "none" %>
          <% listofpros.push(mynewprofile) %>

          <% @profiles.each do |profile|  %>
            <% listofpros.push(profile) if profile.title == "processor" %>
          <% end %>
          <%= f.collection_select :processor_id, listofpros, :user_id, :firstname, {prompt: false}, { :class => "btn btn-default btn-lg dropdown-toggle btn-lg input-lg form-control", "required"=>"false"} %>
        </div>
      </div>

      <div class="col-xs-6 col-sm-6">
        <div class="input-group">
          <div class="input-group-addon">Progress Made </div>
          <%= f.select :progressmail, options_for_select([['email notification', true], ["don't email notification", false]], @record.progressmail),{:selected => params[:progressmail]}, {:class => "input-lg form-control"} %>
        </div>
      </div>
      <div class="col-xs-6 col-sm-6">
        <div class="input-group">
          <div class="input-group-addon">Phase Completion </div>
          <%= f.select :phasemail, options_for_select([['email notification', true], ["don't email notification", false]], @record.phasemail),{:selected => params[:phasemail]}, {:class => "input-lg form-control"} %>
        </div>
      </div>

      <% @phases.order(:phase_id).each do |phase|  %>
        <div class="col-xs-12 col-sm-12">
          <% phasecomplete = true %>
          <% phase.progressions.each do |progression| %>
            <% if !@steps.exists?(:record_id => @record.id, :progression_id => progression.id) %>
              <% phasecomplete = false %>
            <% end %>
          <% end %>  
          <h3>
            <% if phasecomplete == true %>
              <%= image_tag("justcheckon.png", size: "64x64", alt: "Done", "style"=>"padding:2px") %>
              <%= phase.name %>
            <% else %>
              <%= image_tag("justcheckoff.png", size: "64x64", alt: "Done", "style"=>"padding:2px") %>
              <%= phase.name %>
            <% end %>
          </h3>
        </div>
        <% phase.progressions.each do |progression| %>
          <div class="col-xs-6 col-sm-6">
            <h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <% if @steps.exists?(:record_id => @record.id, :progression_id => progression.id) %>
              <%= link_to image_tag("checkon.png", size: "48x48", alt: "Done", "style"=>"padding:2px"), { :controller => :records, :action => :removestep, :id=>@record.id, :progression_id => progression.id } %>
              <!--<%= link_to "Mark Undone", { :controller => :records, :action => :removestep, :id=>@record.id, :progression_id => progression.id }, :class =>"btn btn-lg btn-success" %>-->
            <% else %>
            <%= link_to image_tag("checkoff.png", size: "48x48", alt: "Done", "style"=>"padding:2px"), { :controller => :records, :action => :addstep, :id=>@record.id, :progression_id => progression.id } %>
              
              <!--<%= link_to "Mark Done", { :controller => :records, :action => :addstep, :id=>@record.id, :progression_id => progression.id }, :class =>"btn btn-lg btn-default" %>-->
            <% end %>
            <%= progression.name %></h4>
          </div>
        <% end %>
      <% end %>  <p />

      <div class="clearfix visible-xs-block"></div>
      <div class="col-xs-6 col-sm-6">
        <div class="text-left">
        <% if current_user.profile.title == "admin" || current_user.id == @record.loanofficer_id || current_user.id == @record.processor_id %>
          <%= link_to(image_tag("trash.png", size: "18x20", alt: "Remove", "style"=>"padding:2px"), @record, method: :delete, data: { confirm: 'Are you sure you want to permanently destroy this client record?' }, :class => 'btn btn-default btn-lg') %>
        <% end %>
        </div>
      </div>
      <div class="col-xs-6 col-sm-6">
        <div class="text-right">
          <div class="actions">
              <%= f.submit "Submit", :class=> "btn btn-info btn-lg" %>
          </div>
        </div>
      </div>   
    </div>  
  <% end %>
</div>  